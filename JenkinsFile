pipeline{
    agent any
    environment{
        staging_server="52.15.119.205"
    }
    stages{
        stage('SCM Checkout') {
            steps {
                git credentialsId: 'github-token', branch: 'master', url: 'https://github.com/Bala0911/Hostel-Management-System.git'
                
            }
        }
        stage('sonarqube analysis') {
            steps {
                withSonarQubeEnv('sonar-server') {
                    script {
                        def scannerHome = tool 'SonarQube Scanner'
                        withEnv(["PATH+SONARSCANNER=${scannerHome}/bin"]) {
                            sh 'sonar-scanner \
                                -Dsonar.projectKey=Hostel-Management \
                                -Dsonar.sources=${WORKSPACE}'
                        }
                    }
                }
            }
        }
        stage('Deploy to Dev Server'){
        input {
            message "Do you want to proceed for deployment?"
        }
        steps {
            sh 'ssh -o StrictHostKeyChecking=no ubuntu@${staging_server}'
            sh 'rsync -avzh * --delete . --exclude=.git --exclude=README.md ubuntu@${staging_server}:/var/www/html/'
        }
    }
    // stage('Deploy to Dev Server-new'){
    //     input {
    //         message "Do you want to proceed for deployment?"
    //     }
    //     steps {
    //         // git credentialsId: 'github-token', branch: 'dev', url: 'https://github.com/Bala0911/php-web-app.git'
    //         // sh 'ssh -o StrictHostKeyChecking=no ubuntu@${staging_server}'
    //         sh 'rsync -avzh * --delete . --exclude=.git --exclude=README.md ubuntu@${staging_server}:/var/www/html/'
    //         }
    //     }
    }
}